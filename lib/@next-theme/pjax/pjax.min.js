var Pjax=function(){"use strict";function i(t,e,o){return t instanceof HTMLCollection||t instanceof NodeList||t instanceof Array?Array.prototype.forEach.call(t,e,o):e.call(o,t)}function e(t,e,o,n){(e="string"==typeof e?e.split(" "):e).forEach(function(e){s(t,function(t){t.addEventListener(e,o,n)})})}var s=i,h=e,a={outerHTML:function(t,e){t.outerHTML=e.outerHTML,this.onSwitch()},innerHTML:function(t,e){t.innerHTML=e.innerHTML,""===e.className?t.removeAttribute("class"):t.className=e.className,this.onSwitch()},switchElementsAlt:function(t,e){if(t.innerHTML=e.innerHTML,e.hasAttributes())for(var o=e.attributes,n=0;n<o.length;n++)t.attributes.setNamedItem(o[n].cloneNode());this.onSwitch()},replaceNode:function(t,e){t.parentNode.replaceChild(e,t),this.onSwitch()},sideBySide:function(t,e,o,n){var s=Array.prototype.forEach,i=[],a=[],r=document.createDocumentFragment(),l="animationend webkitAnimationEnd MSAnimationEnd oanimationend",c=0,u=function(t){t.target===t.currentTarget&&--c<=0&&i&&(i.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}),a.forEach(function(t){t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")}),i=a=null,this.onSwitch())}.bind(this);n=n||{},s.call(t.childNodes,function(t){i.push(t),t.classList&&!t.classList.contains("js-Pjax-remove")&&(t.hasAttribute("data-pjax-classes")&&(t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")),t.classList.add("js-Pjax-remove"),n.callbacks&&n.callbacks.removeElement&&n.callbacks.removeElement(t),n.classNames&&(t.className+=" "+n.classNames.remove+" "+(o.backward?n.classNames.backward:n.classNames.forward)),c++,h(t,l,u,!0))}),s.call(e.childNodes,function(t){var e;t.classList&&(e="",n.classNames&&(e=" js-Pjax-add "+n.classNames.add+" "+(o.backward?n.classNames.forward:n.classNames.backward)),n.callbacks&&n.callbacks.addElement&&n.callbacks.addElement(t),t.className+=e,t.setAttribute("data-pjax-classes",e),a.push(t),r.appendChild(t),c++,h(t,l,u,!0))}),t.className=e.className,t.appendChild(r)}},o=a;function C(){window._gaq&&_gaq.push(["_trackPageview"]),window.ga&&ga("send","pageview",{page:location.pathname,title:document.title})}function t(){var t="pjax"+(new Date).getTime()+"_"+r;return r++,t}r=0;function n(e,t,n){(t="string"==typeof t?t.split(" "):t).forEach(function(t){var o;(o=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),o.eventName=t,n&&Object.keys(n).forEach(function(t){o[t]=n[t]}),O(e,function(t){var e=!1;t.parentNode||t===document||t===window||(e=!0,document.body.appendChild(t)),t.dispatchEvent(o),e&&t.parentNode.removeChild(t)})})}function l(t){if(null===t||"object"!=typeof t)return t;var e,o=t.constructor();for(e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);return o}var r,c,u,d,f,p,m,w,v,g,y,b,E,x,A,R,T,j,N,P,S,O=i;function q(t){this.state={numPendingSwitches:0,href:null,options:null},this.options=((t=(t=t)||{}).elements=t.elements||"a[href], form[action]",t.selectors=t.selectors||["title",".js-Pjax"],t.switches=t.switches||{},t.switchesOptions=t.switchesOptions||{},t.history=void 0===t.history||t.history,t.analytics="function"==typeof t.analytics||!1===t.analytics?t.analytics:C,t.scrollTo=void 0===t.scrollTo?0:t.scrollTo,t.scrollRestoration=void 0===t.scrollRestoration||t.scrollRestoration,t.cacheBust=void 0===t.cacheBust||t.cacheBust,t.debug=t.debug||!1,t.timeout=t.timeout||0,t.currentUrlFullReload=void 0!==t.currentUrlFullReload&&t.currentUrlFullReload,t.switches.head||(t.switches.head=o.switchElementsAlt),t.switches.body||(t.switches.body=o.switchElementsAlt),t),this.log("Pjax options",this.options),this.options.scrollRestoration&&"scrollRestoration"in history&&(history.scrollRestoration="manual",H(window,"beforeunload",function(){history.scrollRestoration="auto"})),this.maxUid=this.lastUid=U(),this.parseDOM(document),H(window,"popstate",function(t){var e;t.state&&((e=M(this.options)).url=t.state.url,e.title=t.state.title,e.history=!1,e.scrollPos=t.state.scrollPos,t.state.uid<this.lastUid?e.backward=!0:e.forward=!0,this.lastUid=t.state.uid,this.loadUrl(t.state.url,e))}.bind(this))}var L=i,U=t,H=e,k=n,M=l;return q.switches=a,q.prototype={log:function(){this.options.debug&&console&&("function"==typeof console.log?console.log.apply(console,arguments):console.log&&console.log(arguments))},getElements:function(t){return t.querySelectorAll(this.options.elements)},parseDOM:function(t){var e=function(){if(u)return c;u=1;var e="data-pjax-state";return c=function(t){switch(t.tagName.toLowerCase()){case"a":t.hasAttribute(e)||this.attachLink(t);break;case"form":t.hasAttribute(e)||this.attachForm(t);break;default:throw"Pjax can only be applied on <a> or <form> submit"}}}();L(this.getElements(t),e,this)},refresh:function(t){this.parseDOM(t||document)},reload:function(){window.location.reload()},attachLink:function(){if(f)return d;f=1;function n(t,e){var o,n;a(e)||(o=s(this.options),n=t,(n=1<e.which||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey?"modifier":n.protocol!==window.location.protocol||n.host!==window.location.host?"external":n.hash&&n.href.replace(n.hash,"")===window.location.href.replace(location.hash,"")?"anchor":n.href===window.location.href.split("#")[0]+"#"?"anchor-empty":void 0)?t.setAttribute(i,n):(e.preventDefault(),this.options.currentUrlFullReload&&t.href===window.location.href.split("#")[0]?(t.setAttribute(i,"reload"),this.reload()):(t.setAttribute(i,"load"),o.triggerElement=t,this.loadUrl(t.href,o))))}var t=e,s=l,i="data-pjax-state",a=function(t){return t.defaultPrevented||!1===t.returnValue};return d=function(e){var o=this;e.setAttribute(i,""),t(e,"click",function(t){n.call(o,e,t)}),t(e,"keyup",function(t){13===t.keyCode&&n.call(o,e,t)}.bind(this))}}(),attachForm:function(){if(m)return p;m=1;var t=e,i=l,a="data-pjax-state",r=function(t){return t.defaultPrevented||!1===t.returnValue};return p=function(e){var o=this;e.setAttribute(a,""),t(e,"submit",function(t){!function(u,t){var e,o,n,s;r(t)||((e=i(this.options)).requestOptions={requestUrl:u.getAttribute("action")||window.location.href,requestMethod:u.getAttribute("method")||"GET"},(o=document.createElement("a")).setAttribute("href",e.requestOptions.requestUrl),s=e,(s=(n=o).protocol!==window.location.protocol||n.host!==window.location.host?"external":n.hash&&n.href.replace(n.hash,"")===window.location.href.replace(location.hash,"")?"anchor":n.href===window.location.href.split("#")[0]+"#"?"anchor-empty":s.currentUrlFullReload&&n.href===window.location.href.split("#")[0]?"reload":void 0)?u.setAttribute(a,s):(t.preventDefault(),"multipart/form-data"===u.enctype?e.requestOptions.formData=new FormData(u):e.requestOptions.requestParams=function(){for(var t=[],e=u.elements,o=0;o<e.length;o++){var n=e[o],s=n.tagName.toLowerCase();if(n.name&&void 0!==n.attributes&&"button"!==s){var i=n.attributes.type;if(!i||"checkbox"!==i.value&&"radio"!==i.value||n.checked){var a=[];if("select"===s)for(var r,l=0;l<n.options.length;l++)(r=n.options[l]).selected&&!r.disabled&&a.push(r.hasAttribute("value")?r.value:r.text);else a.push(n.value);for(var c=0;c<a.length;c++)t.push({name:encodeURIComponent(n.name),value:encodeURIComponent(a[c])})}}}return t}(),u.setAttribute(a,"submit"),e.triggerElement=u,this.loadUrl(o.href,e)))}.call(o,e,t)})}}(),forEachSelectors:function(t,e,o){return function(){if(v)return w;v=1;var s=i;return w=function(t,e,o,n){n=n||document,t.forEach(function(t){s(n.querySelectorAll(t),e,o)})}}().bind(this)(this.options.selectors,t,e,o)},switchSelectors:function(t,e,o,n){return y||(y=1,c=i,u=a,g=function(s,i,t,e,a,r){var l=[];t.forEach(function(o){var t=e.querySelectorAll(o),n=a.querySelectorAll(o);if(this.log&&this.log("Pjax switch",o,t,n),t.length!==n.length)throw"DOM doesn’t look the same on new loaded page: ’"+o+"’ - new "+t.length+", old "+n.length;c(t,function(t,e){e=n[e],this.log&&this.log("newEl",t,"oldEl",e),e=s[o]?s[o].bind(this,e,t,r,i[o]):u.outerHTML.bind(this,e,t,r);l.push(e)},this)},this),this.state.numPendingSwitches=l.length,l.forEach(function(t){t()})}),g.bind(this)(this.options.switches,this.options.switchesOptions,t,e,o,n);var c,u},latestChance:function(t){window.location=t},onSwitch:function(){k(window,"resize scroll"),this.state.numPendingSwitches--,0===this.state.numPendingSwitches&&this.afterAllSwitches()},loadContent:function(t,e){if("string"==typeof t){var o=document.implementation.createHTMLDocument("pjax"),n=t.match(/<html[^>]+>/gi);if(n&&n.length&&(n=n[0].match(/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi)).length&&(n.shift(),n.forEach(function(t){t=t.trim().split("=");1===t.length?o.documentElement.setAttribute(t[0],!0):o.documentElement.setAttribute(t[0],t[1].slice(1,-1))})),o.documentElement.innerHTML=t,this.log("load content",o.documentElement.attributes,o.documentElement.innerHTML.length),document.activeElement&&function(t,e,o){for(var n=0;n<e.length;n++)for(var s=t.querySelectorAll(e[n]),i=0;i<s.length;i++)if(s[i].contains(o))return!0;return!1}(document,this.options.selectors,document.activeElement))try{document.activeElement.blur()}catch(t){}this.switchSelectors(this.options.selectors,o,document,e)}else k(document,"pjax:complete pjax:error",e)},abortRequest:function(){if(A)return x;A=1;var e=E?b:(E=1,b=function(){});return x=function(t){t&&t.readyState<4&&(t.onreadystatechange=e,t.abort())}}(),doRequest:function(){if(N)return j;N=1;var u=T?R:(T=1,R=function(t,e,o){var n=new RegExp("([?&])"+e+"=.*?(&|$)","i"),s=-1!==t.indexOf("?")?"&":"?";return t.match(n)?t.replace(n,"$1"+e+"="+o+"$2"):t+s+e+"="+o});return j=function(e,o,n){var t,s=(o=o||{}).requestOptions||{},i=(s.requestMethod||"GET").toUpperCase(),a=s.requestParams||null,s=s.formData||null,r=null,l=new XMLHttpRequest,c=o.timeout||0;if(l.onreadystatechange=function(){4===l.readyState&&(200===l.status?n(l.responseText,l,e,o):0!==l.status&&n(null,l,e,o))},l.onerror=function(t){console.log(t),n(null,l,e,o)},l.ontimeout=function(){n(null,l,e,o)},a&&a.length)switch(t=a.map(function(t){return t.name+"="+t.value}).join("&"),i){case"GET":e=e.split("?")[0],e+="?"+t;break;case"POST":r=t}else s&&(r=s);return o.cacheBust&&(e=u(e,"t",Date.now())),l.open(i,e,!0),l.timeout=c,l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.setRequestHeader("X-PJAX","true"),l.setRequestHeader("X-PJAX-Selectors",JSON.stringify(o.selectors)),r&&"POST"===i&&!s&&l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(r),l}}(),handleResponse:function(){if(S)return P;S=1;var i=l,a=t,r=n;return P=function(t,e,o,n){if((n=i(n||this.options)).request=e,!1!==t){var s=window.history.state||{},s=(window.history.replaceState({url:s.url||window.location.href,title:s.title||document.title,uid:s.uid||a(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href),o),e=(e.responseURL?o!==e.responseURL&&(o=e.responseURL):e.getResponseHeader("X-PJAX-URL")?o=e.getResponseHeader("X-PJAX-URL"):e.getResponseHeader("X-XHR-Redirected-To")&&(o=e.getResponseHeader("X-XHR-Redirected-To")),document.createElement("a")),s=(e.href=s,e.hash);e.href=o,s&&!e.hash&&(e.hash=s,o=e.href),this.state.href=o,this.state.options=n;try{this.loadContent(t,n)}catch(t){if(r(document,"pjax:error",n),this.options.debug)throw t;return console&&console.error&&console.error("Pjax switch fail: ",t),this.latestChance(o)}}else r(document,"pjax:complete pjax:error",n)}}(),loadUrl:function(t,e){e="object"==typeof e?function(t){if(null==t)return null;for(var e=Object(t),o=1;o<arguments.length;o++){var n=arguments[o];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}({},this.options,e):M(this.options),this.log("load href",t,e),this.abortRequest(this.request),k(document,"pjax:send",e),this.request=this.doRequest(t,e,this.handleResponse.bind(this))},executeScripts:function(t){t.forEach(function(t){var e=t.text||t.textContent||t.innerHTML||"",o=document.createElement("script");t.id&&(o.id=t.id),t.className&&(o.className=t.className),t.type&&(o.type=t.type),t.src&&(o.src=t.src,o.async=!1),void 0!==t.dataset.pjax&&(o.dataset.pjax=""),""!==e&&o.appendChild(document.createTextNode(e)),t.parentNode.replaceChild(o,t)})},afterAllSwitches:function(){var t=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop(),t=(t&&document.activeElement!==t&&t.focus(),this.options.selectors.forEach(function(t){L(document.querySelectorAll(t),function(t){})}),this.state);if(t.options.history&&(window.history.state||(this.lastUid=this.maxUid=U(),window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)),this.lastUid=this.maxUid=U(),window.history.pushState({url:t.href,title:t.options.title,uid:this.maxUid,scrollPos:[0,0]},t.options.title,t.href)),this.forEachSelectors(function(t){this.parseDOM(t)},this),k(document,"pjax:complete pjax:success",t.options),"function"==typeof t.options.analytics&&t.options.analytics(),t.options.history){var e=document.createElement("a");if(e.href=this.state.href,e.hash){var e=e.hash.slice(1),e=decodeURIComponent(e),o=0,n=document.getElementById(e)||document.getElementsByName(e)[0];if(n&&n.offsetParent)for(;o+=n.offsetTop,n=n.offsetParent;);window.scrollTo(0,o)}else!1!==t.options.scrollTo&&(1<t.options.scrollTo.length?window.scrollTo(t.options.scrollTo[0],t.options.scrollTo[1]):window.scrollTo(0,t.options.scrollTo))}else t.options.scrollRestoration&&t.options.scrollPos&&window.scrollTo(t.options.scrollPos[0],t.options.scrollPos[1]);this.state={numPendingSwitches:0,href:null,options:null}}},q}();